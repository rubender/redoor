!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).rprovider=t()}(this,(function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const t=Object.prototype.hasOwnProperty;function n(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}const o="undefined"!=typeof window&&void 0!==window.document;let r=()=>{};return function({Component:i,createContext:s,createElement:a}){class u extends i{shouldComponentUpdate(e,o){const{renderComponent1:r,...i}=this.props,{renderComponent2:s,...a}=e;return!function(e,o){if(n(e,o))return!0;if("object"!=typeof e||null===e||"object"!=typeof o||null===o)return!1;const r=Object.keys(e),i=Object.keys(o);if(r.length!==i.length)return!1;let s=r.length;for(;s--;)if(!t.call(o,r[s])||!n(e[r[s]],o[r[s]]))return!1;return!0}(i,a)}render(){const{renderComponent:e,...t}=this.props;return e(t)}}const c=(t,n)=>{let o=function({Modules:e}){let t={},n={},o={};return e.forEach((e,i)=>{e.__module_name?void 0===o[e.__module_name]?o[e.__module_name]=e.__module_name:r("warn","initState","Duplicate modules name "+e.__module_name):(e.__module_name="module_No_"+i,r("warn","initState",`Module in createStore No:[${i+1}] has no __module_name; add to file \nexport const __module_name = "your module name";`));for(const o in e)"action"!==o.substr(0,6)&&"a_"!==o.substr(0,2)||(void 0===n[o]?n[o]=e.__module_name||" ":r("error","initState",`Modules: ${e.__module_name} <-> ${n[o]} has dublicate action: ${o}`),t[o]=e[o])}),t}({Modules:n,__dbg:r});return class extends i{constructor(t){if(super(t),e(this,"__cxRun",(e,t,n=(()=>{}))=>{try{let i;"string"==typeof e&&(i=o[e]({done:this.__updateState,state:this.state,actions:o,emit:this.__emit,args:t}),r("action",e,t)),"object"==typeof e&&(i=e,r("action","setState",e)),"function"==typeof e&&(i=e,r("action","setState","[[function]]")),this.__updateState(i,n)}catch(t){o[e]||r("error",e,"provider.js -> No action function: ["+e+"]"),r("error",e,"Error: ',"+t.toString())}}),e(this,"__emit",(e,t)=>{r("emit",e,t),this.listeners.map(n=>{n(e,t)})}),e(this,"__updateState",(e,t)=>{if(null==e)return null;this.setState(e,t)}),this.listeners=[],!Array.isArray(n))return r("error","createStore","Error: createStore() actions must be an array!");const i=function({Modules:e,props:t}){let n={},o={};return e.forEach((e,i)=>{if(e.initState){let s,a=typeof e.initState;if("object"==a)s=e.initState;else{if("function"!=a)return void r("warn","initState",`Warning: ${e.__module_name||`$Module No:[${i}] in initState`} mast be function or object`);s=e.initState(t.providerConfig)}Object.keys(s).map(t=>{void 0!==o[t]?r("warn","initState",`Warning: ${o[t]} - "${e.__module_name||`$Module No:[${i}] in initState`}" duplicate initState. Key: "${t}"\n`):o[t]=e.__module_name||t}),n=Object.assign({},n,s)}else r("warn","initState",`Warning: ${e.__module_name||`$Module No:[${i}] in createStore`} Actions file has no initState`)}),n}({Modules:n,props:t,__dbg:r});r("action","initState",i),this.state={...i},n.map(e=>{e.bindStateMethods&&e.bindStateMethods(()=>this.state,this.__updateState,this.__emit),e.listen&&this.listeners.push(e.listen)})}render(){r("state","state",this.state);let e={state:this.state,cxRun:this.__cxRun,cxEmit:this.__emit};return a(t.Provider,{value:e},this.props.children)}}};return(e,t=!1)=>{t&&function(e){let t={};function n(e,t,n){"warn"===e?console.warn(`rprovider: ${e} : ${t} : ${n}`,n):"error"===e?console.error(`rprovider: ${e} : ${t} : ${n}`,n):console.log(`rprovider: ${e} : ${t} : ${n}`,n)}r=(e,t,o)=>{n(e,t,o)},console.log("provider.js -> runDebugger: ",e,r);const i=`ws://${e&&e.host||"localhost"}:${e&&e.port||8666}`,s=e&&e.name||"debugger"+~~(1e3*Math.random());e&&e.WebSocket?t=new e.WebSocket(i):o&&(t=new WebSocket(i)),o&&(window.onerror=function(e,t,n,o,i){r("error","error",{msg:e,url:t,lineNo:n,columnNo:o,error:i.stack.toString()})}),t.onopen=e=>{console.log(`\nProvider WebSocket debuger connection is successful.\nurl: ${i}\nname:${s}\n\n`),r=(e,o,r)=>{n(e,o,r);let i={type:e,name:o,args:r};i.proj_name=s,i.created=Date.now(),t&&setTimeout(()=>t.send(JSON.stringify(i)))}},t.onerror=e=>{},t.onclose=e=>{console.log(`Provider WebSocket  debugger connection (${i}) is closed.`)}}(t);const n=s();var i;return{Provider:c(n,e),Connect:(i=n.Consumer,(e,t)=>{const n=(e=>{let t=e=>e;if(e){if("string"==typeof e){let n=(e=e.replace(/\s+/g,"")).split(/[,]/g).filter(e=>e.length);t=e=>n.reduce((t,n)=>(t[n]=e[n],t),{})}"function"==typeof e&&(t=e)}return t})(t),o=t=>a(e,{...t},null),r=e=>a(i,null,t=>{const{state:r,cxRun:i,cxEmit:s}=t,c=n(r||{});let l={renderComponent:o,...e,...c,cxRun:i,cxEmit:s};return a(u,{...l},null)});return r.displayName=`Connect(${e.displayName||e.name||"Unknown"})`,r})}}}}));
